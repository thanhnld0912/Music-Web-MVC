@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = null;
    ViewData["Title"] = "User";
    var isAuthenticated = Context.Session.GetString("UserId") != null;
    @model PagedResult<MusicWeb.Models.UserViewModel>

}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Music Web</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="~/css/user.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onclick="">
    <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" onclick="toggleSidebar(event)">☰</button>
        <div class="logoimg"><img src="~/img/lgo.png" /></div>
        <div class="logo">Melofy</div>
        <div>
            <button class="sidebar-button" onclick="location.href='@Url.Action("Dashboard", "Admin")'">Dashboard</button>
        </div>
        <div>
            <button class="sidebar-button active">User</button>
        </div>
        <div>
            <button class="sidebar-button" onclick="location.href='@Url.Action("Post", "Admin")'">Post</button>
        </div>
        <div>
            <button class="sidebar-button" onclick="location.href='@Url.Action("Cover", "Admin")'">Cover Song</button>
        </div>
    </div>

    <div class="content-wrapper">

        <div class="navbar">
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="What do you want to hear?">
                </div>
                <div class="auth-buttons">
                    @if (isAuthenticated)
                    {
                        <a href="@Url.Action("Profile", "Account")" class="avatar-container">
                            <img src="/img/admin.jpg" alt="Avatar" class="user-avatar">
                        </a>
                    }
                </div>
            </div>
        </div>

        <div class="user-management">
            <h2>Manage</h2>
            <table class="user-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Post</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model.Items)
                    {
                        <tr>
                            <td>@user.Id</td>
                            <td>@user.Username</td>
                            <td>@user.Email</td>
                            <td>@user.PostCount</td>
                            <td>
                                <button class="btn delete" onclick="confirmModal(@user.Id)">Delete</button>
                                @if ((user.IsDisabled ?? false))
                                {
                                    <button class="btn disable" onclick="enableUser(@user.Id)">Enable</button>
                                }
                                else
                                {
                                    <button class="btn disable" onclick="disableModal(@user.Id)">Disable</button>
                                }
                                <button class="btn more">More</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="pagination">
                @if (Model.HasPrevious)
                {
                    <button class="page-redirect-btn"  onclick="window.location.href='@Url.Action("User", "Admin", new { page = Model.CurrentPage - 1 })'">
                        &laquo;
                    </button>
                }

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <button class="page-btn @(i == Model.CurrentPage ? "active" : "")"
                                onclick="window.location.href='@Url.Action("User", "Admin", new { page = i})'">
                        @i
                    </button>
                }

                @if (Model.HasNext)
                {
                    <button class="page-redirect-btn" onclick="window.location.href='@Url.Action("User", "Admin", new { page = Model.CurrentPage + 1 })'">
                        &raquo;
                    </button>
                }
            </div>
        </div>
    </div>

    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <h3>CONFIRM</h3>
            <p>Are you sure you want to delete this user?</p>
            <div class="confirm-modal-buttons">
                <button class="btn no" onclick="closeConfirmModal()">No</button>
                <button class="btn yes" onclick="confirmDelete()">Yes</button>
            </div>
        </div>
    </div>

    <div id="disableModal" class="disable-modal" style="display: none">
        <div class="disable-modal-content">
            <div class="disable-modal-header">
                <h1>INFORMATION</h1>
                <span class="modal-close" onclick="closeDisableModal()">&#10006;</span>
            </div>

            <div class="disable-modal-body">
                <p style="font-weight: bold;">
                    Status: <span style="color: red;">Disable 365 days</span>
                    <span style="font-size: 22px; color: red;">&#x26A0;</span>
                </p>
                @* <form method="post" id="disableForm" asp-action="DisableUser"> *@
                @*     <input type="hidden" name="userId" id="disableUserId"/> *@
                @*     <div class="disable-modal-buttons"> *@
                @*         <button type="button" class="btn-no" onclick="closeDisableModal()">No</button> *@
                @*         <button type="submit" class="btn-yes">Yes</button> *@
                @*     </div> *@
                @* </form> *@
                <div class="disable-modal-buttons">
                    <button class="btn-no" onclick="closeDisableModal()">No</button>
                    <button class="btn-yes" onclick="confirmDisable()">Yes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedConfirmUserId = null;
        let selectedDisableUserId = null;

        function toggleSidebar(event) {
            event.stopPropagation();
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function confirmModal(userId) {
            selectedConfirmUserId = userId;
            document.getElementById("confirmModal").style.display = "flex";
        }

        function closeConfirmModal() {
            document.getElementById("confirmModal").style.display = "none";
            selectedConfirmUserId = null;
        }

        function confirmDelete() {
            if (selectedConfirmUserId !== null) {
                window.location.href = `/Admin/DeleteUser?id=${selectedConfirmUserId}`;
            }
        }

        function disableModal(userId) {
            selectedDisableUserId = userId;
            document.getElementById("disableModal").style.display = "flex";
        }

        function closeDisableModal() {
            document.getElementById("disableModal").style.display = "none";
            selectedDisableUserId = null;
        }

        function confirmDisable() {
            if (selectedDisableUserId !== null) {
                window.location.href = `/Admin/DisableUser?id=${selectedDisableUserId}`;
            }
        }

        function enableUser(userId) {
            if (userId !== null) {
                window.location.href = `/Admin/EnableUser?id=${userId}`;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="~/js/chart.js"></script>
</body>
</html>


